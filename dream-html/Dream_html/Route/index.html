<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Route (dream-html.Dream_html.Route)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">dream-html</a> &#x00BB; <a href="../index.html">Dream_html</a> &#x00BB; Route</nav><header class="odoc-preamble"><h1>Module <code><span>Dream_html.Route</span></code></h1><p>Bidirectional routes with type-safe path segment parsing and printing using OCaml's built-in format strings, and support for scoped middleware.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> v3.9.0</li></ul></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-path"><a href="#type-path" class="anchor"></a><code><span><span class="keyword">type</span> <span>(_, _) path</span></span></code></div><div class="spec-doc"><p>This contains the path formats that are used to parse and print the routes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-path"><a href="#val-path" class="anchor"></a><code><span><span class="keyword">val</span> path : 
  <span><span><span>(<span class="type-var">'r</span>, unit, <span><span class="xref-unresolved">Dream</span>.response <span class="xref-unresolved">Dream</span>.promise</span>)</span> <span class="xref-unresolved">Stdlib</span>.format</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'p</span>, unit, string, <a href="../index.html#type-attr">attr</a>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'r</span>, <span class="type-var">'p</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>path request_fmt attr_fmt</code> is a route path. The <code>ppx_dream_html</code> PPX provides a more convenient way.</p><p>Without PPX: <code>let order = path &quot;/orders/%s&quot; &quot;/orders/%s&quot;</code></p><p>With PPX: <code>let order = [%route_path &quot;/orders/%s&quot;]</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-link"><a href="#val-link" class="anchor"></a><code><span><span class="keyword">val</span> link : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">'p</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'p</span>, unit, string, <a href="../index.html#type-attr">attr</a>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span></span></code></div><div class="spec-doc"><p><code>link path</code> is a dream-html attribute value that prints out the filled <code>path</code> given its parameters. Use this instead of hard-coding your route URLs throughout your app, to make it easy to refactor routes with minimal effort.</p><p>Eg:</p><pre class="language-ocaml"><code>open Dream_html
open HTML

a [href (Route.link order) &quot;yzxyzc&quot;] [txt &quot;My Order&quot;]</code></pre><p>Renders: <code>&lt;a href=&quot;/orders/yzxyzc&quot;&gt;My Order&lt;/a&gt;</code></p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>A route that can handle a templated request path.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : <span><span class="optlabel">?meth</span>:<span class="xref-unresolved">Dream</span>.method_ <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'r</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'r</span>)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>make ?meth path handler</code> is a route which handles requests with <code>meth</code> if specified, or any method otherwise.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">path</span> <p>format string is used to match against requests and print out filled paths as links. It accepts the following format specifiers:</p><p><code>%s</code> matches against any sequence of characters upto (excluding) a <code>/</code>.</p><p><code>%*s</code> matches against the rest of the path, and then passes as handler params the number of characters captured as well as the captured substring. This can be used as a catch-all, eg to respond with a customized 'not found' message.</p><p><code>%d</code> matches against any integer.</p><p><code>%c</code> matches against any single character.</p><p><code>%%</code> at the <i>end</i> of the route format string matches against an optional trailing <code>/</code> character, allowing you to flexibly handle requests either way.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">handler</span> <p>takes the Dream request and any parameters that are parsed from the path as arguments and returns a Dream response.</p><p>Examples:</p><pre class="language-ocaml"><code>let get_account_version =
  make ~meth:`GET [%route_path &quot;/accounts/%s/versions/%d&quot;] (fun _req acc ver -&gt;
    Dream.html (Printf.sprintf &quot;Account: %s, version: %d&quot; acc ver))

let get_order = make ~meth:`GET [%route_path &quot;/orders/%s&quot;] (fun _ id -&gt; Dream.html id)</code></pre></li></ul></div></div><p>The following are convenience functions for creating routes.</p><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span><span><span>(<span class="type-var">'r</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'r</span>)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-post"><a href="#val-post" class="anchor"></a><code><span><span class="keyword">val</span> post : <span><span><span>(<span class="type-var">'r</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'r</span>)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-put"><a href="#val-put" class="anchor"></a><code><span><span class="keyword">val</span> put : <span><span><span>(<span class="type-var">'r</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'r</span>)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delete"><a href="#val-delete" class="anchor"></a><code><span><span class="keyword">val</span> delete : <span><span><span>(<span class="type-var">'r</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'r</span>)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-head"><a href="#val-head" class="anchor"></a><code><span><span class="keyword">val</span> head : <span><span><span>(<span class="type-var">'r</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'r</span>)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-connect"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : <span><span><span>(<span class="type-var">'r</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'r</span>)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-options"><a href="#val-options" class="anchor"></a><code><span><span class="keyword">val</span> options : <span><span><span>(<span class="type-var">'r</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'r</span>)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-trace"><a href="#val-trace" class="anchor"></a><code><span><span class="keyword">val</span> trace : <span><span><span>(<span class="type-var">'r</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'r</span>)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-patch"><a href="#val-patch" class="anchor"></a><code><span><span class="keyword">val</span> patch : <span><span><span>(<span class="type-var">'r</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'r</span>)</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-format"><a href="#val-format" class="anchor"></a><code><span><span class="keyword">val</span> format : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>format route</code> is the template string used to match request paths against the <code>route</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-handler"><a href="#val-handler" class="anchor"></a><code><span><span class="keyword">val</span> handler : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Dream</span>.handler</span></code></div><div class="spec-doc"><p><code>handler route</code> converts the <code>route</code> into a Dream handler.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&gt;&gt;)"><a href="#val-(&gt;&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;&gt;) : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>route1 &gt;&gt; route2</code> joins together <code>route1</code> and <code>route2</code> into a new route so that requests targeting either of them will match. Use this to build your app's routes. Eg, in Dream your routes might look like:</p><pre class="language-ocaml"><code>Dream.router [
  Dream.get &quot;/echo/:word&quot; Echo.get;
  Dream.post &quot;/echo/:word&quot; Echo.post;
]</code></pre><p>With <code>( &gt;&gt; )</code> it would look like:</p><pre class="language-ocaml"><code>let echo = [%route_path &quot;/echo/%s&quot;]
...
Route.handler (
  Route.get echo Echo.get &gt;&gt;
  Route.post echo Echo.post
)</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&amp;&amp;)"><a href="#val-(&amp;&amp;)" class="anchor"></a><code><span><span class="keyword">val</span> (&amp;&amp;) : <span><span class="xref-unresolved">Dream</span>.middleware <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Dream</span>.middleware <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Dream</span>.middleware</span></code></div><div class="spec-doc"><p><code>middleware1 &amp;&amp; middleware2</code> joins together two Dream middlewares so that <code>middleware1</code> is applied first, then <code>middleware2</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_"><a href="#val-with_" class="anchor"></a><code><span><span class="keyword">val</span> with_ : <span><span class="xref-unresolved">Dream</span>.middleware <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>with_ middleware route</code> is a route that matches any of the paths handled in <code>route</code>, and handles those requests by applying the <code>middleware</code> and the <code>route</code> handler. Eg:</p><pre class="language-ocaml"><code>let add_header prev req =
  let open Lwt.Syntax in
  let+ resp = prev req in
  Dream.add_header resp &quot;X-Api-Server&quot; &quot;Dream&quot;;
  resp

let get_order_v2 =
  with_ add_header (get [%route_path &quot;/v2/orders/%s&quot;] (fun _ id -&gt; Dream.html id))</code></pre><p>In the example above, <code>get_order_v2</code> will match against requests with paths like &quot;/v2/orders/%s&quot;, apply the <code>add_header</code> middleware, and handle the request.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><a href="#type-t">t</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp</code> is a formatter that prints out a simple summary of the route, eg <code>GET /foo/%s</code> or just <code>/foo/%s</code> if the route matches any method.</p></div></div></div></body></html>
